# 🔗 건강 체크 - 환자 관리 시스템 연동 설계서

## 1. 연동 가능성 분석

### 1.1 현재 시스템 구조

| 시스템 | 데이터 파일 | 주요 필드 |
|--------|------------|----------|
| 건강 체크 | health_records.csv | date, name, age, gender, height, weight, bp, bmi, risk_score |
| 환자 관리 | patients.csv | patient_id, name, age, gender, medical_condition, doctor, hospital |

### 1.2 공통 필드 분석

```
건강 체크          환자 관리
─────────         ─────────
name       ←───→  name       (이름)
age        ←───→  age        (나이)  
gender     ←───→  gender     (성별)
```

### 1.3 연동 가능성 판정: ✅ **연동 가능**

**근거:**
1. 공통 필드(이름, 나이, 성별)로 매칭 가능
2. patient_id를 건강 기록에 추가하여 명확한 연결 가능
3. 건강 위험도 → 진단명 매핑 가능 (비만→Obesity, 고혈압→Hypertension 등)

---

## 2. 연동 설계

### 2.1 연동 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                    🏥 의료 종합 관리 시스템                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌───────────────────┐         ┌───────────────────┐          │
│   │  💓 건강 체크 시스템  │◄───────►│  📋 환자 관리 시스템  │          │
│   │                   │         │                   │          │
│   │  - BMI 분석       │         │  - 환자 CRUD      │          │
│   │  - 혈압 분석       │         │  - 검색/통계       │          │
│   │  - 위험도 계산     │         │  - 퇴원 처리       │          │
│   └─────────┬─────────┘         └─────────┬─────────┘          │
│             │                             │                    │
│             ▼                             ▼                    │
│   ┌─────────────────────────────────────────────────┐          │
│   │            🔗 IntegrationManager                │          │
│   │                                                 │          │
│   │  - 환자 ↔ 건강기록 연결                          │          │
│   │  - 위험도 → 진단명 변환                          │          │
│   │  - 통합 검색/조회                               │          │
│   └─────────────────────────────────────────────────┘          │
│                           │                                    │
│                           ▼                                    │
│   ┌─────────────────────────────────────────────────┐          │
│   │                 📁 data/                        │          │
│   │  patients.csv | health_records.csv (patient_id) │          │
│   └─────────────────────────────────────────────────┘          │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 데이터 스키마 변경

#### health_records.csv (수정)
```csv
# 기존
date,name,age,gender,height,weight,ap_hi,ap_lo,...

# 변경 (patient_id 추가)
date,patient_id,name,age,gender,height,weight,ap_hi,ap_lo,...
```

### 2.3 연동 기능 목록

| 기능 | 설명 | 위치 |
|------|------|------|
| 환자 선택 건강체크 | 기존 환자 선택하여 건강 체크 | 건강 체크 GUI |
| 건강 기록 조회 | 환자별 건강 기록 히스토리 | 환자 관리 GUI |
| 자동 진단명 추천 | 위험도 기반 진단명 제안 | 건강 체크 GUI |
| 빠른 환자 등록 | 건강 체크 후 바로 환자 등록 | 건강 체크 GUI |
| 통합 대시보드 | 양쪽 데이터 통합 조회 | 메인 메뉴 |

---

## 3. 상세 설계

### 3.1 IntegrationManager 클래스

```python
class IntegrationManager:
    """두 시스템을 연동하는 브릿지 클래스"""
    
    def __init__(self, base_path):
        self.health_manager = HealthDataManager(base_path)
        self.patient_manager = PatientManager(base_path)
    
    # 환자 ID로 건강 기록 조회
    def get_health_records_by_patient(self, patient_id) -> list
    
    # 건강 위험도 → 진단명 변환
    def suggest_condition(self, health_data) -> str
    
    # 건강 체크 결과로 환자 등록
    def register_patient_from_health(self, health_data, extra_info) -> tuple
    
    # 환자 목록 조회 (건강 체크용)
    def get_patient_list() -> list
    
    # 통합 통계
    def get_integrated_statistics() -> dict
```

### 3.2 위험도 → 진단명 매핑 규칙

| 건강 지표 | 조건 | 추천 진단명 |
|----------|------|------------|
| BMI | ≥ 25 (비만) | Obesity |
| 혈압 | ≥ 140/90 | Hypertension |
| 혈당 | level 3 | Diabetes |
| 위험점수 | ≥ 60 | Cancer (정밀검사 권고) |
| 기본 | - | Asthma (기본값) |

### 3.3 GUI 변경사항

#### 건강 체크 GUI 추가 요소
```
┌─────────────────────────────────────────────────────────┐
│  💓 건강 상태 체크 시스템                    [연동모드] ✓  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─ 환자 선택 (선택사항) ──────────────────────────────┐  │
│  │  [▼ 환자 선택...                              ]  │  │
│  │  ☐ 신규 사용자로 진행                            │  │
│  └──────────────────────────────────────────────────┘  │
│                                                         │
│  ... (기존 입력 폼) ...                                 │
│                                                         │
│  ┌─ 분석 결과 ─────────────────────────────────────────┐  │
│  │  추천 진단명: [Obesity    ▼]                      │  │
│  │                                                    │  │
│  │  [💾 저장] [📋 환자로 등록] [📊 기록 보기]         │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

#### 환자 관리 GUI 추가 요소
```
버튼 영역:
[➕ 등록] [📝 수정] [🗑️ 삭제] [📋 상세] [🏥 퇴원] [💓 건강기록] [📊 통계]
                                          ↑ 새로 추가
```

### 3.4 건강 기록 연결 다이얼로그

```
┌─────────────────────────────────────────────────────────┐
│  💓 건강 기록 히스토리 - 김민수 (P001)                    │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌───────────────────────────────────────────────────┐  │
│  │  날짜        BMI    혈압      위험도   상태        │  │
│  ├───────────────────────────────────────────────────┤  │
│  │  2026-01-09  26.1   130/85    45점    ⚠️ 주의    │  │
│  │  2025-12-20  27.3   135/88    52점    ⚠️ 주의    │  │
│  │  2025-11-15  28.0   140/90    58점    🔴 위험    │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  📈 추이: BMI ↓개선  |  혈압 ↓개선  |  위험도 ↓개선     │
│                                                         │
│                              [닫기]                     │
└─────────────────────────────────────────────────────────┘
```

---

## 4. 파일 구조

```
medical_system/
├── src/
│   ├── main.py
│   ├── integration/              # 🆕 연동 모듈
│   │   ├── __init__.py
│   │   └── integration_manager.py
│   ├── health_app/
│   │   ├── health_checker.py
│   │   ├── data_manager.py      # 수정: patient_id 지원
│   │   └── health_gui.py        # 수정: 환자 선택 기능
│   └── patient_app/
│       ├── patient.py
│       ├── patient_manager.py
│       └── patient_gui.py       # 수정: 건강 기록 조회
└── data/
    ├── patients.csv
    └── health_records.csv       # 수정: patient_id 컬럼 추가
```

---

## 5. 구현 우선순위

| 순위 | 기능 | 복잡도 | 영향도 |
|------|------|--------|--------|
| 1 | IntegrationManager 클래스 | 중 | 높음 |
| 2 | health_records.csv 스키마 변경 | 낮 | 높음 |
| 3 | 건강 체크 GUI - 환자 선택 | 중 | 높음 |
| 4 | 환자 관리 GUI - 건강 기록 조회 | 중 | 중 |
| 5 | 자동 진단명 추천 | 낮 | 중 |
| 6 | 빠른 환자 등록 | 중 | 중 |

---

## 6. KDT12 학습 연계

| Day | 활용 내용 |
|-----|----------|
| Day03 | 딕셔너리 - 두 시스템 데이터 매핑 |
| Day04 | 함수 - 연동 함수 설계 |
| Day05 | **모듈** - integration 패키지 분리 |
| Day06 | **클래스 상속** - Manager 클래스 확장 |
| Day07 | tkinter - 연동 UI 구현 |
| Day08 | 파일 I/O - CSV 스키마 변경 |

---

## 7. 예상 결과

### 연동 전
- 건강 체크 → 별도 저장
- 환자 관리 → 별도 관리
- 데이터 연결 없음

### 연동 후
- 건강 체크 → 환자와 연결하여 저장
- 환자 관리 → 건강 기록 히스토리 조회 가능
- 위험도 기반 진단명 자동 추천
- 통합 통계 및 추이 분석

---

*작성일: 2026-01-09*
*버전: 1.0*
